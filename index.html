<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MERCADO DE LOCALES | Campana</title>
    <link href="https://fonts.googleapis.com/css2?family=Proxima+Nova&family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
    <style>
        :root {
            --meli-yellow: #ffe600;
            --meli-blue: #2d3277;
            --bg-body: #f5f5f5;
            --bg-card: #ffffff;
            --text-primary: #333333;
            --color-low: #00a650;
            --color-mid: #ffab00;
            --color-hot: #ff3b3b;
            --tile-radius: 4px;
            --shadow-soft: 0 2px 10px rgba(0,0,0,0.08);
            --shadow-hover: 0 25px 80px rgba(0,0,0,0.6);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Proxima Nova', 'Roboto', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }
        header {
            background-color: var(--meli-yellow);
            padding: 12px 15px;
            position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header-content {
            width: 100%; margin: 0 auto;
            display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 15px;
        }
        .logo-area {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .logo-img {
            height: 80px;
            width: auto;
        }
        .logo-text {
            font-weight: 900;
            font-size: 1.4rem;
            color: var(--meli-blue);
            line-height: 1;
            letter-spacing: -0.5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .logo-text span {
            display: block;
            font-size: 1rem;
            font-weight: 700;
        }
        .segmentation-area {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            font-size: 1rem;
            flex: 1;
            text-align: center;
        }
        .location-badge {
            display: flex; align-items: center; gap: 8px; font-weight: 700; color: var(--meli-blue);
            font-size: 1.1rem;
        }
        .location-badge i { font-size: 1.3rem; }
        .search-container {
            flex: 1; background: white; border-radius: 8px; min-width: 220px;
            display: flex; align-items: center; padding: 10px 16px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        #search-input { border: none; width: 100%; outline: none; font-size: 1rem; }
        .right-buttons {
            display: flex; align-items: center; gap: 10px;
        }
        .view-toggle-btn, .ig-btn {
            background: white; border: none; width: 42px; height: 42px; border-radius: 50%;
            color: var(--meli-blue); font-size: 1.2rem; cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center;
        }
        .ig-btn { color: #E4405F; font-size: 1.4rem; }
        .tickers-stack { background: white; border-bottom: 1px solid #ddd; font-size: 0.75rem; }
        .ticker-wrap { width: 100%; overflow: hidden; white-space: nowrap; height: 28px; display: flex; align-items: center; }
        .ticker { display: inline-block; }
        .t-aviso .ticker { padding-left: 100%; animation: ticker-left 160s linear infinite; }
        .t-hot .ticker { padding-right: 100%; animation: ticker-right 150s linear infinite; }
        .ticker-item { display: inline-block; padding: 0 3.5rem; font-weight: 600; text-transform: uppercase; }
        @keyframes ticker-left { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
        @keyframes ticker-right { 0% { transform: translateX(-100%); } 100% { transform: translateX(0); } }
        .t-aviso { background: var(--meli-blue); color: white; }
        .t-hot { background: #ffebeb; color: var(--color-hot); }
        .filter-bar { overflow-x: auto; white-space: nowrap; padding: 8px 10px; background: white; display: flex; gap: 6px; align-items: center; }
        .btn-filter {
            background: #f0f0f0; border: none; padding: 6px 14px; border-radius: 20px;
            font-size: 0.8rem; font-weight: 600; color: #555; cursor: pointer; transition: 0.3s;
        }
        .btn-filter.active { background: var(--meli-blue); color: white; }
        .btn-filter.green-btn.active { background: var(--color-low); color: white; }
        .btn-filter.yellow-btn.active { background: var(--color-mid); color: white; }
        .btn-filter.red-btn.active { background: var(--color-hot); color: white; }
        .separator { width:1px; height: 20px; background:#ddd; margin:0 5px; }
        .board-container {
            flex: 1; position: relative; margin: 15px auto;
            width: 98%; max-width: 1800px; padding-bottom: 80px;
            overflow: visible;
        }
        #puzzle-board { position: relative; width: 100%; transition: height 0.3s; overflow: visible; }
        .tile {
            background: var(--bg-card); border-radius: var(--tile-radius);
            overflow: hidden; cursor: pointer; box-shadow: var(--shadow-soft);
            display: flex; flex-direction: column;
            transition: transform 0.2s cubic-bezier(0.2, 0.8, 0.2, 1), box-shadow 0.2s;
            border: 1px solid #eee;
            transform-origin: center center;
        }
        .view-matrix .tile:hover {
            transform: scale(3) !important;
            z-index: 5000 !important;
            box-shadow: var(--shadow-hover);
            border: 1px solid #ccc;
            position: relative;
        }
        @keyframes pulse-border { 0%,100%{border-color:transparent;} 50%{border-color:currentColor;box-shadow:0 0 10px currentColor;} }
        .tier-green { color: var(--color-low); }
        .tier-yellow { color: var(--color-mid); }
        .tier-red { color: var(--color-hot); }
        .view-matrix .tile:not(:hover).tier-green { animation: pulse-border 3s infinite; }
        .view-matrix .tile:not(:hover).tier-yellow { animation: pulse-border 3s infinite; }
        .view-matrix .tile:not(:hover).tier-red { animation: pulse-border 2s infinite; }
        .tile-img { width: 100%; height: 70%; object-fit: cover; }
        .tile-info {
            height: 30%; padding: 8px;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            text-align: center; background: white;
        }
        .tile-title { 
            font-weight: 700; 
            font-size: 0.75rem;
            color: #333; 
            line-height: 1.1; 
            margin-bottom: 4px; 
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap; 
            width: 90%;
        }
        .tile-discount { 
            font-weight: 900; 
            font-size: 0.9rem;
            padding: 4px 8px; 
            border-radius: 4px; 
        }
        .tier-green .tile-discount { color: var(--color-low); background: rgba(0,166,80,0.1); }
        .tier-yellow .tile-discount { color: var(--color-mid); background: rgba(255,171,0,0.1); }
        .tier-red .tile-discount { color: var(--color-hot); background: rgba(255,59,59,0.1); }
        .view-list #puzzle-board { display: flex; flex-direction: column; gap: 15px; padding: 10px; }
        .view-list .tile {
            position: relative !important; top: auto !important; left: auto !important;
            width: 100% !important; height: 300px !important;
            transform: none !important;
        }
        .view-list .tile-title { font-size: 1.4rem; white-space: normal; width: 100%; }
        .view-list .tile-discount { font-size: 1.2rem; }
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 6000;
            display: flex; flex-direction: column; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .modal.active { opacity: 1; pointer-events: auto; }
        .gallery-container { width: 100%; max-width: 500px; margin: 0 auto; position: relative; }
        .gallery-card { background: white; border-radius: 15px; overflow: hidden; margin: 20px; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from {transform: translateY(50px);} to {transform: translateY(0);} }
        .gallery-img { width: 100%; height: 350px; object-fit: cover; }
        .gallery-body { padding: 20px; text-align: center; }
        .btn-action { display: block; width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 8px; font-weight: bold; border: none; cursor: pointer; text-decoration: none; }
        .btn-wa { background: #25D366; color: white; }
        .btn-url { background: var(--meli-blue); color: white; }
        .nav-arrow { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.2); color: white; border: none; width: 50px; height: 50px; border-radius: 50%; font-size: 1.5rem; cursor: pointer; z-index: 6005; backdrop-filter: blur(5px); }
        .nav-prev { left: 10px; } .nav-next { right: 10px; }
        .close-modal { position: absolute; top: 20px; right: 20px; background: none; border: none; color: white; font-size: 2rem; cursor: pointer; z-index: 6005; }
        .fab-pub {
            position: fixed; bottom: 20px; right: 20px;
            background: var(--meli-blue); color: white;
            padding: 15px 25px; border-radius: 50px; font-weight: bold;
            box-shadow: 0 4px 15px rgba(45, 50, 119, 0.4);
            cursor: pointer; z-index: 900; display: flex; align-items: center; gap: 10px;
        }
        .form-modal-content { background: white; padding: 25px; border-radius: 15px; width: 90%; max-width: 400px; margin: auto; position: relative; }
        .form-input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; }
        footer {
            background: white;
            padding: 20px;
            text-align: center;
            font-size: 0.85rem;
            color: #555;
            border-top: 1px solid #eee;
        }
        footer a { color: var(--meli-blue); text-decoration: none; }
        .ripple { position: absolute; border-radius: 50%; background: rgba(255,255,255,0.5); transform: scale(0); animation: ripple-anim 0.6s linear; pointer-events: none; }
        @keyframes ripple-anim { to { transform: scale(4); opacity: 0; } }
    </style>
</head>
<body class="view-matrix">
    <header>
        <div class="header-content">
            <div class="logo-area">
                <img class="logo-img" src="mercado de locales.png" alt="Mercado de Locales">
                <div class="logo-text">
                    MERCADO
                    <span>DE LOCALES</span>
                </div>
            </div>
          
            <div class="segmentation-area">
                <div class="location-badge">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Campana, Buenos Aires</span>
                </div>
            </div>

            <div class="search-container">
                <input type="text" id="search-input" placeholder="Buscar carnicer√≠a, farmacia..." onkeyup="handleSearch(this.value)">
                <i class="fas fa-search" style="color:#ccc;"></i>
            </div>
          
            <div class="right-buttons">
                <button class="view-toggle-btn" onclick="toggleViewMode()">
                    <i class="fas fa-th-large" id="view-icon"></i>
                </button>
                <a href="https://www.instagram.com/mercadodelocales/" target="_blank" class="ig-btn">
                    <i class="fab fa-instagram"></i>
                </a>
            </div>
        </div>
    </header>

    <div class="tickers-stack">
        <div class="ticker-wrap t-aviso"><div class="ticker" id="tick-aviso"></div></div>
        <div class="ticker-wrap t-hot"><div class="ticker" id="tick-hot"></div></div>
    </div>

    <div class="filter-bar">
        <button class="btn-filter" onclick="resetAll()">Todo</button>
        <button class="btn-filter" onclick="filter('cat', 'CARNICERIA', this)">ü•© Carnicer√≠a</button>
        <button class="btn-filter" onclick="filter('cat', 'FARMACIA', this)">üíä Farmacia</button>
        <button class="btn-filter" onclick="filter('cat', 'FERRETERIA', this)">üîß Ferreter√≠a</button>
        <button class="btn-filter" onclick="filter('cat', 'HELADERIA', this)">üç¶ Helader√≠a</button>
        <button class="btn-filter" onclick="filter('cat', 'PANADERIA', this)">üçû Panader√≠a</button>
        <button class="btn-filter" onclick="filter('cat', 'VERDULERIA', this)">ü•¶ Verduler√≠a</button>
        <button class="btn-filter" onclick="filter('cat', 'TALLER_MECANICO', this)">üõ†Ô∏è Taller Mec√°nico</button>
        <button class="btn-filter" onclick="filter('cat', 'SALUD', this)">üè• Salud</button>
        <button class="btn-filter" onclick="filter('cat', 'GYM', this)">üí™ Gym</button>
        <button class="btn-filter" onclick="filter('cat', 'TECNOLOGIA', this)">üì± Tecnolog√≠a</button>
        <button class="btn-filter" onclick="filter('cat', 'COMIDA', this)">üçî Comida</button>
        <button class="btn-filter" onclick="filter('cat', 'BARES', this)">üçª Bares</button>
        <button class="btn-filter" onclick="filter('cat', 'ENTRETENIMIENTO', this)">üéâ Entretenimiento</button>
        <button class="btn-filter" onclick="filter('cat', 'SERVICIOS', this)">üîß Servicios</button>
        <div class="separator"></div>
        <button class="btn-filter green-btn" onclick="filter('discount', 'green', this)">üü¢ < 20%</button>
        <button class="btn-filter yellow-btn" onclick="filter('discount', 'yellow', this)">üü° 20-40%</button>
        <button class="btn-filter red-btn" onclick="filter('discount', 'red', this)">üî¥ > 40%</button>
    </div>

    <div class="board-container">
        <div id="puzzle-board"></div>
    </div>

    <footer>
        <p>Seguinos en <a href="https://www.instagram.com/mercadodelocales/" target="_blank"><i class="fab fa-instagram"></i> @mercadodelocales</a></p>
        <p><button onclick="openPrivacyModal()" style="background:none;border:none;color:var(--meli-blue);text-decoration:underline;cursor:pointer;">Pol√≠tica de Privacidad y Responsabilidad</button></p>
        <p style="margin-top:10px;font-size:0.75rem;color:#999;">¬© 2026 Mercado de Locales - Campana</p>
    </footer>

    <div class="fab-pub" onclick="openFormModal()">
        <i class="fas fa-bullhorn"></i> Publicit√°
    </div>

    <div class="modal" id="gallery-modal">
        <button class="close-modal" onclick="closeGallery()">&times;</button>
        <button class="nav-arrow nav-prev" onclick="navGallery(-1)"><i class="fas fa-chevron-left"></i></button>
        <button class="nav-arrow nav-next" onclick="navGallery(1)"><i class="fas fa-chevron-right"></i></button>
        <div class="gallery-container">
            <div class="gallery-card" id="gallery-card-content"></div>
        </div>
    </div>

    <div class="modal" id="form-modal" style="background:rgba(0,0,0,0.8);">
        <div class="form-modal-content">
            <h3 style="text-align:center; color:var(--meli-blue); margin-bottom:15px;">Publicitar en Campana</h3>
            <p style="text-align:center; font-size:0.8rem; color:#666; margin-bottom:15px;">
                Sumate a las mejores ofertas de la zona.
            </p>
            <form onsubmit="sendWhatsappForm(event)">
                <input type="text" id="frm-nombre" class="form-input" placeholder="Nombre del Local" required>
                <select id="frm-rubro" class="form-input" required>
                    <option value="" disabled selected>Seleccion√° el Rubro</option>
                    <option value="Carnicer√≠a">Carnicer√≠a</option>
                    <option value="Farmacia">Farmacia</option>
                    <option value="Ferreter√≠a">Ferreter√≠a</option>
                    <option value="Helader√≠a">Helader√≠a</option>
                    <option value="Panader√≠a">Panader√≠a</option>
                    <option value="Verduler√≠a">Verduler√≠a</option>
                    <option value="Taller Mec√°nico">Taller Mec√°nico</option>
                    <option value="Salud">Salud</option>
                    <option value="Gym">Gym</option>
                    <option value="Tecnolog√≠a">Tecnolog√≠a</option>
                    <option value="Comida">Comida</option>
                    <option value="Bares">Bares</option>
                    <option value="Entretenimiento">Entretenimiento</option>
                    <option value="Servicios">Servicios</option>
                    <option value="Otro">Otro</option>
                </select>
                <input type="text" id="frm-ubicacion" class="form-input" placeholder="Direcci√≥n en Campana" required>
                <button type="submit" class="btn-action btn-wa" style="margin-top:15px;">Enviar Solicitud üöÄ</button>
            </form>
            <button class="btn-action" style="background:transparent; color:#666;" onclick="closeFormModal()">Cancelar</button>
        </div>
    </div>

    <div class="modal" id="privacy-modal" style="background:rgba(0,0,0,0.8);">
        <div class="form-modal-content" style="max-height:90vh; overflow-y:auto;">
            <button onclick="closePrivacyModal()" style="position:absolute; top:10px; right:15px; background:none; border:none; font-size:2rem; cursor:pointer; color:#333;">&times;</button>
            <h3 style="text-align:center; color:var(--meli-blue); padding:20px 20px 10px;">Pol√≠tica de Privacidad y Responsabilidad</h3>
            <div style="padding:0 20px 30px; line-height:1.6; font-size:0.9rem;">
                <ol style="padding-left:20px;">
                    <li><strong>Introducci√≥n</strong><br>La presente Pol√≠tica de Privacidad y Responsabilidad establece los t√©rminos bajo los cuales "Mercado de Locales" opera y ofrece sus servicios de publicidad digital. Al utilizar nuestros servicios, el usuario acepta las condiciones aqu√≠ descritas.</li>
                    <li><strong>Alcance de los Servicios</strong><ul style="padding-left:20px; margin:10px 0;"><li>La plataforma tiene como √∫nico objetivo la difusi√≥n y promoci√≥n publicitaria de locales, productos o servicios de terceros.</li><li>No participamos, gestionamos ni supervisamos las transacciones comerciales que puedan surgir entre usuarios y anunciantes.</li><li>Cualquier compra, contrataci√≥n o acuerdo realizado entre el usuario y un tercero es responsabilidad exclusiva de las partes involucradas.</li></ul></li>
                    <li><strong>Exenci√≥n de Responsabilidad</strong><br>La plataforma no se hace responsable por: la calidad, disponibilidad o veracidad de los productos y servicios anunciados; los t√©rminos de pago, entrega o garant√≠a ofrecidos por terceros; da√±os, p√©rdidas o perjuicios derivados de transacciones realizadas fuera de nuestro entorno publicitario. El usuario reconoce que la plataforma act√∫a √∫nicamente como medio de publicidad y no como intermediario comercial.</li>
                    <li><strong>Privacidad de Datos</strong><ul style="padding-left:20px; margin:10px 0;"><li>La plataforma recopila √∫nicamente la informaci√≥n necesaria para la gesti√≥n de anuncios y la mejora de la experiencia del usuario.</li><li>Los datos personales no ser√°n compartidos con terceros sin consentimiento expreso, salvo obligaci√≥n legal.</li><li>Se aplican medidas de seguridad razonables para proteger la informaci√≥n, aunque no podemos garantizar protecci√≥n absoluta frente a accesos no autorizados.</li></ul></li>
                    <li><strong>Obligaciones del Usuario</strong><ul style="padding-left:20px; margin:10px 0;"><li>El usuario se compromete a utilizar la plataforma de manera l√≠cita y respetuosa.</li><li>Es responsabilidad del usuario verificar la autenticidad y condiciones de cualquier oferta publicada.</li><li>El usuario exonera a la plataforma de cualquier reclamo derivado de sus interacciones con terceros.</li></ul></li>
                    <li><strong>Modificaciones</strong><br>La plataforma se reserva el derecho de modificar esta pol√≠tica en cualquier momento. Las actualizaciones ser√°n publicadas en nuestro sitio web y entrar√°n en vigor inmediatamente despu√©s de su publicaci√≥n.</li>
                    <li><strong>Contacto</strong><br>Para consultas relacionadas con esta pol√≠tica, los usuarios pueden comunicarse con nosotros a trav√©s de <a href="mailto:mercadodelocales@gmail.com">mercadodelocales@gmail.com</a>.</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        const DESKTOP_COLS = 14;
        const MOBILE_COLS = 4;
        const ROWS = 14;
        const GAP = 4;

        let COLS = window.innerWidth > 800 ? DESKTOP_COLS : MOBILE_COLS;
        let viewMode = 'matrix';
        let tiles = [];
        let displayedTiles = [];
        let currentGalleryIndex = 0;

        const baseData = [
            { name: "Carnicer√≠a El Toro", cat: "CARNICERIA", discount: 45, img: "https://images.unsplash.com/photo-1607623174012-3e2c3b8d9f8d?w=400", location: "Av. Rivadavia 1234, Campana", url: "https://instagram.com/carniceriaeltoro", whatsapp: "543489111111", hours: { days: "Lun-S√°b", from: "08:00", to: "20:00", sundayClosed: true } },
            { name: "Farmacia Central", cat: "FARMACIA", discount: 15, img: "https://images.unsplash.com/photo-1585435557343-3b092031a831?w=400", location: "Belgrano 567, Campana", url: "https://instagram.com/farmaciacentral", whatsapp: "543489222222", hours: { days: "Lun-Dom", from: "08:00", to: "22:00", sundayClosed: false } },
            { name: "Ferreter√≠a Industrial", cat: "FERRETERIA", discount: 25, img: "https://images.unsplash.com/photo-1581235720704-06d3acfcb36f?w=400", location: "San Mart√≠n 890, Campana", url: "https://instagram.com/ferreteriaindustrial", whatsapp: "543489333333", hours: { days: "Lun-Vie", from: "09:00", to: "18:00", sundayClosed: true } },
            { name: "Helader√≠a Grid", cat: "HELADERIA", discount: 30, img: "https://images.unsplash.com/photo-1576506295286-5cda18df43e7?w=400", location: "Roca 456, Campana", url: "https://instagram.com/heladeriagrid", whatsapp: "543489444444", hours: { days: "Lun-Dom", from: "10:00", to: "23:00", sundayClosed: false } },
            { name: "Carnicer√≠a Julian", cat: "CARNICERIA", discount: 10, img: "https://images.unsplash.com/photo-1560781290-7dc94c0f8f4f?w=400", location: "Mitre 789, Campana", url: "https://instagram.com/carniceriajulian", whatsapp: "543489555555", hours: { days: "Lun-S√°b", from: "08:00", to: "20:00", sundayClosed: true } },
            { name: "Farmacia Nueva", cat: "FARMACIA", discount: 5, img: "https://images.unsplash.com/photo-1631549916768-4119b2e5f926?w=400", location: "9 de Julio 321, Campana", url: "https://instagram.com/farmacianueva", whatsapp: "543489666666", hours: { days: "Lun-Dom", from: "00:00", to: "23:59", sundayClosed: false } },
            { name: "Herramientas Pro", cat: "FERRETERIA", discount: 50, img: "https://images.unsplash.com/photo-1530124566582-a618bc2615dc?w=400", location: "Sarmiento 654, Campana", url: "https://instagram.com/herramientaspro", whatsapp: "543489777777", hours: { days: "Lun-Vie", from: "08:30", to: "17:30", sundayClosed: true } },
            { name: "Helados Artesanales", cat: "HELADERIA", discount: 18, img: "https://images.unsplash.com/photo-1501443762994-82bd5dace89a?w=400", location: "Alberdi 987, Campana", url: "https://instagram.com/heladosartesanales", whatsapp: "543489888888", hours: { days: "Lun-Dom", from: "12:00", to: "00:00", sundayClosed: false } },
            { name: "El Rey de la Carne", cat: "CARNICERIA", discount: 22, img: "https://images.unsplash.com/photo-1542838132-92c53300491e?w=400", location: "Castelli 234, Campana", url: "https://instagram.com/elreydelacarne", whatsapp: "543489999999", hours: { days: "Lun-S√°b", from: "07:00", to: "21:00", sundayClosed: true } },
            { name: "Farmacia Del Pueblo", cat: "FARMACIA", discount: 42, img: "https://images.unsplash.com/photo-1587854692152-cbe660dbde88?w=400", location: "Rivadavia 567, Campana", url: "https://instagram.com/farmaciadelpueblo", whatsapp: "543489000000", hours: { days: "Lun-Dom", from: "08:00", to: "22:00", sundayClosed: false } },
            { name: "Panader√≠a La Espiga", cat: "PANADERIA", discount: 30, img: "https://images.unsplash.com/photo-1509440159596-0249088772ff?w=400", location: "Balcarce 890, Campana", url: "https://instagram.com/panaderialaespiga", whatsapp: "543489112233", hours: { days: "Lun-Dom", from: "06:00", to: "22:00", sundayClosed: false } },
            { name: "Verduler√≠a Fresca", cat: "VERDULERIA", discount: 25, img: "https://images.unsplash.com/photo-1610348726304-b1c5e6f984e6?w=400", location: "Lavalle 123, Campana", url: "https://instagram.com/verduleriafresca", whatsapp: "543489223344", hours: { days: "Lun-S√°b", from: "07:00", to: "20:00", sundayClosed: true } },
            { name: "Taller El R√°pido", cat: "TALLER_MECANICO", discount: 40, img: "https://images.unsplash.com/photo-1621905252507-b3541bc6ea34?w=400", location: "Roca 456, Campana", url: "https://instagram.com/tallerelrapido", whatsapp: "543489334455", hours: { days: "Lun-Vie", from: "08:00", to: "18:00", sundayClosed: true } },
            { name: "Centro M√©dico Salud", cat: "SALUD", discount: 15, img: "https://images.unsplash.com/photo-1532938911079-1b0c8f3473ed?w=400", location: "San Mart√≠n 789, Campana", url: "https://instagram.com/centromedicosaud", whatsapp: "543489445566", hours: { days: "Lun-Vie", from: "08:00", to: "20:00", sundayClosed: true } },
            { name: "Gym Power", cat: "GYM", discount: 50, img: "https://images.unsplash.com/photo-1517838277536-f5f99be501cd?w=400", location: "Belgrano 321, Campana", url: "https://instagram.com/gympower", whatsapp: "543489556677", hours: { days: "Lun-Dom", from: "06:00", to: "23:00", sundayClosed: false } },
            { name: "Tecnolog√≠a Store", cat: "TECNOLOGIA", discount: 35, img: "https://images.unsplash.com/photo-1468495244123-6c6c332eeece?w=400", location: "Mitre 654, Campana", url: "https://instagram.com/tecnologiastore", whatsapp: "543489667788", hours: { days: "Lun-S√°b", from: "10:00", to: "20:00", sundayClosed: true } },
            { name: "Restaurante Sabor", cat: "COMIDA", discount: 35, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400", location: "Av. 6 de Julio 111, Campana", url: "https://instagram.com/restaurantesabor", whatsapp: "543489778899", hours: { days: "Lun-Dom", from: "12:00", to: "23:00", sundayClosed: false } },
            { name: "Pizzer√≠a Napoli", cat: "COMIDA", discount: 20, img: "https://images.unsplash.com/photo-1513104890138-7c749659a591?w=400", location: "25 de Mayo 222, Campana", url: "https://instagram.com/pizzerianapoli", whatsapp: "543489889900", hours: { days: "Lun-Dom", from: "19:00", to: "00:00", sundayClosed: false } },
            { name: "Bar El Encuentro", cat: "BARES", discount: 40, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400", location: "Rivadavia 333, Campana", url: "https://instagram.com/barelencuentro", whatsapp: "543489990011", hours: { days: "Lun-Dom", from: "18:00", to: "04:00", sundayClosed: false } },
            { name: "Pub Nocturno", cat: "BARES", discount: 25, img: "https://images.unsplash.com/photo-1572116469696-31de0f17cc43?w=400", location: "Castelli 444, Campana", url: "https://instagram.com/pubnocturno", whatsapp: "543489001122", hours: { days: "Jue-Dom", from: "20:00", to: "05:00", sundayClosed: false } },
            { name: "Cine Campana", cat: "ENTRETENIMIENTO", discount: 30, img: "https://images.unsplash.com/photo-1536440136628-849c177e76a1?w=400", location: "Centro Cultural, Campana", url: "https://instagram.com/cinecampana", whatsapp: "543489112233", hours: { days: "Lun-Dom", from: "14:00", to: "23:00", sundayClosed: false } },
            { name: "Sala de Juegos Fun", cat: "ENTRETENIMIENTO", discount: 45, img: "https://images.unsplash.com/photo-1549924230-c5b32a11e3d3?w=400", location: "Shopping Campana", url: "https://instagram.com/saladejuegosfun", whatsapp: "543489223344", hours: { days: "Lun-Dom", from: "10:00", to: "22:00", sundayClosed: false } },
            { name: "Lavander√≠a Express", cat: "SERVICIOS", discount: 30, img: "https://images.unsplash.com/photo-1604176354204-9268737828e4?w=400", location: "Av. Principal 999, Campana", url: "https://instagram.com/lavanderiaexpress", whatsapp: "543489123456", hours: { days: "Lun-S√°b", from: "08:00", to: "19:00", sundayClosed: true } },
            { name: "Peluquer√≠a Style", cat: "SERVICIOS", discount: 25, img: "https://images.unsplash.com/photo-1562322140-8baeececf3e2?w=400", location: "Centro, Campana", url: "https://instagram.com/peluqueriastyle", whatsapp: "543489654321", hours: { days: "Lun-S√°b", from: "09:00", to: "20:00", sundayClosed: true } }
        ];

        let activeFilters = { cat: null, discount: null, search: '' };

        function init() {
            setTickers();
            generateMatrix();
            render();
        }

        function setTickers() {
            const noticias = [
                "¬°NUEVOS LOCALES SE SUMAN CADA SEMANA!",
                "OFERTAS EXCLUSIVAS EN CAMPANA",
                "PUBLICIT√Å TU LOCAL GRATIS POR WHATSAPP",
                "M√ÅS DE 20 RUBROS DISPONIBLES",
                "DESCUENTOS HASTA 50% OFF"
            ];
            let avisoHTML = '';
            noticias.forEach(n => avisoHTML += `<span class="ticker-item">${n}</span>`);
            document.getElementById('tick-aviso').innerHTML = avisoHTML.repeat(20);

            let hotHTML = '';
            baseData.forEach(local => {
                hotHTML += `<span class="ticker-item">${local.name.toUpperCase()} - ${local.discount}% OFF</span>`;
            });
            document.getElementById('tick-hot').innerHTML = hotHTML.repeat(15);
        }

        function isLocalOpen(local) {
            const now = new Date();
            const day = now.getDay();
            const currentTime = now.getHours() * 60 + now.getMinutes();

            if (day === 0 && local.hours.sundayClosed) return false;

            const [fromH, fromM] = local.hours.from.split(':').map(Number);
            const [toH, toM] = local.hours.to.split(':').map(Number);
            const fromMinutes = fromH * 60 + fromM;
            const toMinutes = toH * 60 + toM;

            return currentTime >= fromMinutes && currentTime <= toMinutes;
        }

        function toggleViewMode() {
            viewMode = viewMode === 'matrix' ? 'list' : 'matrix';
            document.body.className = viewMode === 'list' ? 'view-list' : 'view-matrix';
            document.getElementById('view-icon').className = viewMode === 'list' ? 'fas fa-th' : 'fas fa-th-large';
            render();
        }

        function generateMatrix() {
            tiles = [];
            let map = Array(ROWS).fill().map(() => Array(COLS).fill(false));
            let dataIdx = 0;
            for(let y = 0; y < ROWS; y++) {
                for(let x = 0; x < COLS; x++) {
                    if(map[y][x]) continue;
                    let isBig = Math.random() > 0.85;
                    let w = (isBig && x < COLS-1) ? 2 : 1;
                    let h = (isBig && y < ROWS-1) ? 2 : 1;
                    if(w === 2 && h === 2 && (map[y][x+1] || map[y+1][x] || map[y+1][x+1])) { w=1; h=1; }
                    for(let i = 0; i < h; i++) for(let j = 0; j < w; j++) map[y+i][x+j] = true;
                    const data = baseData[dataIdx % baseData.length];
                    dataIdx++;
                    let tier = 'tier-green';
                    if(data.discount >= 20) tier = 'tier-yellow';
                    if(data.discount > 40) tier = 'tier-red';
                    tiles.push({ id: `tile-${tiles.length}`, x, y, w, h, ...data, tier });
                }
            }
        }

        function render() {
            const board = document.getElementById('puzzle-board');
            board.innerHTML = '';
            displayedTiles = tiles.filter(t => checkFilter(t));
          
            if(viewMode === 'matrix') {
                const boardWidth = board.parentElement.clientWidth;
                const cellSize = (boardWidth - (GAP * (COLS - 1))) / COLS;
                let maxY = 0;
                displayedTiles.forEach((t, index) => {
                    const el = createTileElement(t, index);
                    el.style.width = `${t.w * cellSize + (t.w - 1) * GAP}px`;
                    el.style.height = `${t.h * cellSize + (t.h - 1) * GAP}px`;
                    el.style.transform = `translate(${t.x * (cellSize + GAP)}px, ${t.y * (cellSize + GAP)}px)`;
                    el.style.position = 'absolute';
                    board.appendChild(el);
                    if(t.y + t.h > maxY) maxY = t.y + t.h;
                });
                board.style.height = `${maxY * (cellSize + GAP)}px`;
            } else {
                board.style.height = 'auto';
                displayedTiles.forEach((t, index) => board.appendChild(createTileElement(t, index)));
            }
        }

        function createTileElement(t, index) {
            const el = document.createElement('div');
            el.className = `tile ${t.tier}`;
            el.innerHTML = `
                <img src="${t.img}" class="tile-img" loading="lazy">
                <div class="tile-info">
                    <div class="tile-title">${t.name}</div>
                    <div class="tile-discount">${t.discount}% OFF</div>
                </div>
            `;
            el.onclick = (e) => {
                const circle = document.createElement('span');
                const d = Math.max(el.clientWidth, el.clientHeight);
                circle.style.width = circle.style.height = `${d}px`;
                circle.style.left = `${e.clientX - el.getBoundingClientRect().left - d/2}px`;
                circle.style.top = `${e.clientY - el.getBoundingClientRect().top - d/2}px`;
                circle.classList.add('ripple');
                el.appendChild(circle);
                setTimeout(() => circle.remove(), 600);
                openGallery(index);
            };
            return el;
        }

        function checkFilter(t) {
            if(activeFilters.cat && t.cat !== activeFilters.cat) return false;
            if(activeFilters.discount === 'green' && t.discount >= 20) return false;
            if(activeFilters.discount === 'yellow' && (t.discount < 20 || t.discount > 40)) return false;
            if(activeFilters.discount === 'red' && t.discount <= 40) return false;
            if(activeFilters.search) {
                const term = activeFilters.search.toLowerCase();
                if(!t.name.toLowerCase().includes(term) && !t.cat.toLowerCase().includes(term)) return false;
            }
            return true;
        }

        function filter(type, val, btn) {
            if(activeFilters[type] === val) {
                activeFilters[type] = null;
                btn.classList.remove('active');
            } else {
                btn.parentElement.querySelectorAll('.btn-filter').forEach(b => b.classList.remove('active'));
                activeFilters[type] = val;
                btn.classList.add('active');
            }
            render();
        }

        function handleSearch(val) { activeFilters.search = val; render(); }

        function resetAll() {
            activeFilters = {cat: null, discount: null, search: ''};
            document.getElementById('search-input').value = '';
            document.querySelectorAll('.btn-filter').forEach(b => b.classList.remove('active'));
            render();
        }

        function openGallery(idx) {
            currentGalleryIndex = idx;
            updateGallery();
            document.getElementById('gallery-modal').classList.add('active');
        }

        function closeGallery() {
            document.getElementById('gallery-modal').classList.remove('active');
        }

        function navGallery(dir) {
            currentGalleryIndex = (currentGalleryIndex + dir + displayedTiles.length) % displayedTiles.length;
            updateGallery();
        }

        function updateGallery() {
            const t = displayedTiles[currentGalleryIndex];
            const now = new Date();
            const optionsDate = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const optionsTime = { hour: '2-digit', minute: '2-digit' };
            const fechaDia = now.toLocaleDateString('es-AR', optionsDate);
            const hora = now.toLocaleTimeString('es-AR', optionsTime);

            const openStatus = isLocalOpen(t) ? 
                '<span style="color:var(--color-low); font-weight:bold; font-size:1.2rem;">üü¢ ABIERTO AHORA</span>' : 
                '<span style="color:var(--color-hot); font-weight:bold; font-size:1.2rem;">üî¥ CERRADO</span>';

            let tierColor = t.discount > 40 ? 'var(--color-hot)' : t.discount >= 20 ? 'var(--color-mid)' : 'var(--color-low)';
            const content = document.getElementById('gallery-card-content');
            content.innerHTML = `
                <img src="${t.img}" class="gallery-img">
                <div class="gallery-body">
                    <h2>${t.name}</h2>
                    <h1 style="color:${tierColor}; font-size: 2.5rem; margin: 15px 0;">${t.discount}% OFF</h1>
                    ${openStatus}
                    <p style="margin:15px 0; font-weight:600;">Horario:</p>
                    <p style="margin-bottom:10px;">${t.hours.days}: ${t.hours.from} - ${t.hours.to} hs</p>
                    <p style="margin:10px 0; font-weight:600;">Ubicaci√≥n:</p>
                    <p style="margin-bottom:20px;">${t.location}</p>
                    <p style="font-size:0.9rem; color:#555; margin:10px 0;">${fechaDia.charAt(0).toUpperCase() + fechaDia.slice(1)} - ${hora} hs</p>
                    <a href="${t.url}" target="_blank" class="btn-action btn-url">
                        <i class="fab fa-instagram"></i> Ver Instagram / Sitio Web
                    </a>
                    <button class="btn-action btn-wa" onclick="window.open('https://wa.me/${t.whatsapp}','_blank')">
                        <i class="fab fa-whatsapp"></i> Contactar por WhatsApp
                    </button>
                </div>
            `;
        }

        function openFormModal() { document.getElementById('form-modal').classList.add('active'); }
        function closeFormModal() { document.getElementById('form-modal').classList.remove('active'); }

        function sendWhatsappForm(e) {
            e.preventDefault();
            const n = document.getElementById('frm-nombre').value;
            const r = document.getElementById('frm-rubro').value;
            const u = document.getElementById('frm-ubicacion').value;
            window.open(`https://api.whatsapp.com/send?phone=+543489686939&text=Hola! Quiero publicitar mi ${r}: ${n} en ${u}`, '_blank');
            closeFormModal();
        }

        function openPrivacyModal() { document.getElementById('privacy-modal').classList.add('active'); }
        function closePrivacyModal() { document.getElementById('privacy-modal').classList.remove('active'); }

        setInterval(() => {
            if(viewMode === 'list' || activeFilters.cat || activeFilters.discount || activeFilters.search) return;
            const idx1 = Math.floor(Math.random() * displayedTiles.length);
            const t1 = displayedTiles[idx1];
            const neighbor = displayedTiles.find(t => t !== t1 && t.w === t1.w && t.h === t1.h && (Math.abs(t.x - t1.x) + Math.abs(t.y - t1.y) === 1));
            if(neighbor) {
                const tx = t1.x, ty = t1.y;
                t1.x = neighbor.x; t1.y = neighbor.y;
                neighbor.x = tx; neighbor.y = ty;
                render();
            }
        }, 2500);

        window.addEventListener('resize', () => {
            COLS = window.innerWidth > 800 ? DESKTOP_COLS : MOBILE_COLS;
            generateMatrix();
            render();
        });

        init();
    </script>
</body>
</html>






















