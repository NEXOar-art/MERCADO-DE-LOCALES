<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MERCADO DE LOCALES | Campana</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
    <script src="https://cdn.jsdelivr.net/npm/vanilla-tilt@1.8.1/dist/vanilla-tilt.min.js"></script>
    <style>
        :root {
            --bg-panel: #1e293b;
            --primary: #2563eb;
            --accent: #fbbf24;
            --hot: #ef4444;
            --green: #22c55e;
            --yellow: #eab308;
            --text-light: #f8fafc;
            --tile-radius: 8px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Roboto Condensed', sans-serif;
            color: var(--text-light);
            min-height: 100vh;
            display: flex; flex-direction: column;
            overflow: hidden;
            background-color: #000;
        }
        .animated-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
            background: linear-gradient(45deg, #0f172a, #1e1b4b);
        }
      
        header {
            background: rgba(0,0,0,0.85); padding: 10px;
            position: sticky; top: 0; z-index: 1000;
            backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }
        .main-title {
            font-family: 'Montserrat', sans-serif; font-size: 1.5rem; font-weight: 900;
            background: linear-gradient(to right, #fff, var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .ticker-container { position: relative; z-index: 900; }
        .ticker-wrap { width: 100%; overflow: hidden; height: 28px; display: flex; align-items: center; white-space: nowrap; }
        .ticker-hot { background: var(--hot); color: white; border-bottom: 1px solid rgba(0,0,0,0.2); }
        .ticker-info { background: #0f172a; color: #60a5fa; height: 26px; border-bottom: 1px solid #1e293b; }
        .ticker-aviso { background: var(--yellow); color: #000; height: 32px; font-weight: bold; border-bottom: 2px solid rgba(0,0,0,0.3); }
        .ticker-aviso .ticker { animation-name: ticker-forward; }
      
        .ticker { display: inline-block; animation-duration: 40s; animation-iteration-count: infinite; animation-timing-function: linear; }
        .ticker-hot .ticker { animation-name: ticker-forward; }
        .ticker-info .ticker { animation-name: ticker-reverse; }
        @keyframes ticker-forward { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        @keyframes ticker-reverse { 0% { transform: translateX(-50%); } 100% { transform: translateX(0); } }
        .ticker-item { display: inline-block; padding: 0 30px; font-size: 0.8rem; font-weight: bold; text-transform: uppercase; }
        .filter-panel {
            width: 95%; max-width: none; margin: 10px auto;
            display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: center;
            background: rgba(255, 255, 0.05); padding: 12px;
            border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        .filter-group { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
        .filter-label { font-size: 0.7rem; font-weight: 900; color: #64748b; margin-right: 5px; }
      
        .btn-filter {
            background: #0f172a; border: 1px solid #334155; color: #94a3b8;
            padding: 0; border-radius: 50%; width: 52px; height: 52px; cursor: pointer; transition: 0.3s;
            font-size: 1.8rem; display: flex; align-items: center; justify-content: center;
        }
        .btn-filter:hover { transform: scale(1.15); }
        .btn-filter.active { color: white; box-shadow: 0 0 15px rgba(37,99,235,0.4); background: var(--primary); }
        .green-btn { border-color: var(--green); }
        .green-btn.active { background: var(--green); }
        .yellow-btn { border-color: var(--yellow); }
        .yellow-btn.active { background: var(--yellow); color: #000; }
        .red-btn { border-color: var(--hot); }
        .red-btn.active { background: var(--hot); box-shadow: 0 0 20px rgba(239,68,68,0.6); }
        .all-btn {
            border-color: #64748b;
            font-size: 1.6rem;
        }
        .all-btn.active {
            background: #64748b;
        }
        .btn-reset {
            background: #334155; color: white; border: none; padding: 0;
            border-radius: 50%; width: 52px; height: 52px; cursor: pointer;
            font-size: 1.8rem; display: flex; align-items: center; justify-content: center;
        }
        .board-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 5px;
            overflow: hidden;
        }
        #puzzle-board { position: relative; }
        .tile {
            position: absolute; background: var(--bg-panel); border-radius: var(--tile-radius);
            cursor: pointer; overflow: hidden; border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.4s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.6);
        }
        .tile.filtered-out { opacity: 0.1; filter: grayscale(1); pointer-events: none; }
        @keyframes blink-hot { 0%, 100% { border-color: var(--hot); box-shadow: 0 0 10px var(--hot); } 50% { border-color: white; box-shadow: 0 0 30px var(--hot); } }
        .tier-high { animation: blink-hot 1.5s infinite; border-color: var(--hot); border-width: 3px; }
        .tier-mid { border-color: var(--yellow); border-width: 2px; }
        .tier-low { border-color: var(--green); border-width: 2px; }
        .tile-img { width: 100%; height: 55%; object-fit: cover; }
        .tile-info {
            height: 45%;
            padding: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .tile-title {
            font-size: 0.65rem;
            font-weight: 900;
            color: white;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-height: 1.2;
        }
        .tile-price {
            font-size: 0.75rem;
            color: var(--accent);
            font-weight: bold;
            margin-top: 6px;
        }
        .modal {
            position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9);
            display:none; align-items:center; justify-content:center; z-index:2000; backdrop-filter: blur(5px);
        }
        .modal.active { display:flex; }
        .modal-content { background:#1e293b; width:90%; max-width:420px; border-radius:15px; overflow:hidden; border:1px solid #334155; }
        .modal-img { width:100%; height:220px; object-fit:cover; }
        .modal-body { padding:20px; text-align:center; }
        .modal-title { color:var(--accent); font-size:1.4rem; margin-bottom:10px; }
        .modal-desc { color:#ccc; margin:15px 0; font-size:0.9rem; }
        .modal-actions {
            display:flex; flex-direction:column; gap:12px; margin-top:20px;
        }
        .modal-btn {
            padding:14px; border-radius:10px; font-weight:bold; cursor:pointer; font-size:1rem;
            display:flex; align-items:center; justify-content:center; gap:10px;
        }
        .btn-wa { background:#25D366; color:white; border:none; }
        .btn-map { background:#4285F4; color:white; border:none; }
        .btn-close { background:none; color:#888; border:1px solid #444; margin-top:10px; }
        .ripple { position: absolute; border-radius: 50%; background: rgba(255,255,255,0.3); transform: scale(0); animation: ripple 0.6s linear; pointer-events: none; }
        @keyframes ripple { to { transform: scale(4); opacity: 0; } }
        @keyframes fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
        }
        .social-panel {
            padding: 15px;
            text-align: center;
            background: rgba(0,0,0,0.6);
        }
        .social-panel a {
            color: white;
            font-size: 2rem;
            margin: 0 15px;
            transition: transform 0.3s;
        }
        .social-panel a:hover { transform: scale(1.2); }
    </style>
</head>
<body>
    <div class="animated-bg"></div>
    <header>
        <div id="clock" style="color:var(--accent); font-size:0.7rem; font-weight:bold;">00:00:00</div>
        <div class="main-title">MERCADO DE LOCALES</div>
    </header>
    <div class="ticker-container">
        <div class="ticker-wrap ticker-aviso">
            <div class="ticker" id="tick-aviso"></div>
        </div>
        <div class="ticker-wrap ticker-hot">
            <div class="ticker" id="tick-hot"></div>
        </div>
        <div class="ticker-wrap ticker-info">
            <div class="ticker" id="tick-info"></div>
        </div>
    </div>
    <div class="filter-panel">
        <div class="filter-group">
            <span class="filter-label">RUBRO:</span>
            <button class="btn-filter all-btn" onclick="resetFilter('cat', this)">üåê</button>
            <button class="btn-filter" onclick="filter('cat', 'TECH', this)">üíª</button>
            <button class="btn-filter" onclick="filter('cat', 'FOOD', this)">üçî</button>
            <button class="btn-filter" onclick="filter('cat', 'MODA', this)">üëó</button>
            <button class="btn-filter" onclick="filter('cat', 'CARNICERIA', this)">ü•©</button>
            <button class="btn-filter" onclick="filter('cat', 'KIOSCO', this)">üè™</button>
            <button class="btn-filter" onclick="filter('cat', 'TALLERMECANICO', this)">üîß</button>
            <button class="btn-filter" onclick="filter('cat', 'MEDICINA', this)">üè•</button>
            <button class="btn-filter" onclick="filter('cat', 'BELLEZA', this)">üíá</button>
            <button class="btn-filter" onclick="filter('cat', 'PETSHOP', this)">üê∂</button>
        </div>
        <div class="filter-group" style="border-left: 1px solid #333; padding-left:10px;">
            <span class="filter-label">PROMOS:</span>
            <button class="btn-filter all-btn" onclick="resetFilter('discount', this)">üåê</button>
            <button class="btn-filter green-btn" onclick="filter('discount', 'green', this)">üü¢</button>
            <button class="btn-filter yellow-btn" onclick="filter('discount', 'yellow', this)">üü°</button>
            <button class="btn-filter red-btn" onclick="filter('discount', 'red', this)">üî•</button>
        </div>
        <button class="btn-reset" onclick="resetAll()">üîÑ</button>
    </div>
    <div class="board-container">
        <div id="puzzle-board"></div>
    </div>
    <div class="social-panel">
        <div>
            <a href="https://www.instagram.com/" target="_blank"><i class="fab fa-instagram"></i></a>
            <a href="https://www.tiktok.com/" target="_blank"><i class="fab fa-tiktok"></i></a>
        </div>
        <button class="btn-reset" style="margin-top:10px; width:auto; padding:8px 20px;" onclick="openPrivacyModal()">Pol√≠ticas de Privacidad</button>
    </div>
    <!-- MODAL DETALLE -->
    <div class="modal" id="modal-shop">
        <div class="modal-content">
            <img id="m-img" class="modal-img" src="">
            <div class="modal-body">
                <h2 id="m-name" class="modal-title"></h2>
                <p id="m-desc" class="modal-desc"></p>
                <div class="modal-actions">
                    <button class="modal-btn btn-wa" id="m-wa">
                        <i class="fab fa-whatsapp"></i> Contactar por WhatsApp
                    </button>
                    <button class="modal-btn btn-map" id="m-map">
                        <i class="fas fa-map-marker-alt"></i> Ver Ubicaci√≥n
                    </button>
                    <button class="modal-btn btn-close" onclick="closeModal()">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" id="modal-privacy">
        <div class="modal-content">
            <div style="padding:20px;">
                <h2 style="color:var(--accent);">Pol√≠ticas de Privacidad</h2>
                <p style="color:#ccc; line-height:1.5;">Esta aplicaci√≥n no recolecta, almacena ni comparte datos personales. Todo el contenido es local y se ejecuta en tu dispositivo.<br><br>Los enlaces externos son gestionados por sus respectivas plataformas.</p>
                <button onclick="closePrivacyModal()" style="width:100%; background:var(--primary); color:white; border:none; padding:15px; border-radius:10px; margin-top:20px; font-weight:bold;">Cerrar</button>
            </div>
        </div>
    </div>
    <script>
        const COLS = 14, ROWS = 14, GAP = 4;
        let CELL_SIZE;
        let tiles = [];
        let activeFilters = { cat: null, discount: null };
        // MATRIZ COMPLETA CON M√ÅS LOCALES
        const tilesData = [
            // CARNICER√çA
            { name: "Carnicer√≠a Juli√°n", cat: "CARNICERIA", discount: 45, img: "https://images.unsplash.com/photo-1589984667390-09eb86d8b8f5?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=9+de+Julio+1185,+Campana" },
            { name: "Estancias del Sur", cat: "CARNICERIA", discount: 50, img: "https://images.unsplash.com/photo-1607623174012-3e2c3b8d9f8d?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=Blvd.+Sarmiento+287,+Campana" },
            { name: "Carnicer√≠a Sarmiento", cat: "CARNICERIA", discount: 30, img: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=Blvd.+Sarmiento+888,+Campana" },
            { name: "Carnicer√≠a Melo", cat: "CARNICERIA", discount: 40, img: "https://images.unsplash.com/photo-1516738909773-2d7e7e9d8b2d?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=Jean+Jaures,+Campana" },
            { name: "Frigor√≠fico Criscar", cat: "CARNICERIA", discount: 25, img: "https://images.unsplash.com/photo-1603048714872-9f7e3c2d3f7e?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=Av.+Rivadavia+1700,+Campana" },
            // KIOSCO
            { name: "Kiosk May 1", cat: "KIOSCO", discount: 15, img: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=Necochea+905,+Campana" },
            { name: "El Kiosco de la Esquina", cat: "KIOSCO", discount: 20, img: "https://images.unsplash.com/photo-1590674899488-8b8f4e7f3d3f?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=Rawson+401,+Campana" },
            { name: "Kiosco del Sol", cat: "KIOSCO", discount: 35, img: "https://images.unsplash.com/photo-1620394780256-9fdfc2f8c5d3?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=San+Mart√≠n+999,+Campana" },
            { name: "Kiosco Las Mellis", cat: "KIOSCO", discount: 10, img: "https://images.unsplash.com/photo-1604719312566-2a3d3e3e68e9?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=Av.+Francisco+Lavezzari+3,+Campana" },
            // TECH
            { name: "Electr√≥nica Proton", cat: "TECH", discount: 50, img: "https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=Av.+Ing.+Agust√≠n+Rocca+290,+Campana" },
            { name: "Megastore", cat: "TECH", discount: 30, img: "https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=Av.+Int.+Jorge+Ruben+Varela+524,+Campana" },
            { name: "Dr. Cell Campana", cat: "TECH", discount: 40, img: "https://images.unsplash.com/photo-1588508065123-6f0d6a5c3f9f?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=Av.+Int.+Jorge+Ruben+Varela+320,+Campana" },
            // MODA
            { name: "Campanitas Mora", cat: "MODA", discount: 35, img: "https://images.unsplash.com/photo-1445205170230-053b830c6050?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=Barnetche+2119,+Campana" },
            { name: "Lola Mona Indumentaria", cat: "MODA", discount: 45, img: "https://images.unsplash.com/photo-1483985988355-763728e1935b?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=Av.+Mitre+1172,+Campana" },
            { name: "Circle Campana", cat: "MODA", discount: 25, img: "https://images.unsplash.com/photo-1539109136881-3d8f7e8d0b3a?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=Av.+Int.+Jorge+Ruben+Varela+1118,+Campana" },
            { name: "Reina Juana", cat: "MODA", discount: 20, img: "https://images.unsplash.com/photo-1590399214748-337e44f2c6e4?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=Av.+Int.+Jorge+Ruben+Varela+502,+Campana" },
            // FOOD
            { name: "La Catedral", cat: "FOOD", discount: 30, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=Av.+Int.+Jorge+Ruben+Varela+370,+Campana" },
            { name: "Emblema", cat: "FOOD", discount: 40, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=Blvd.+Sarmiento+101,+Campana" },
            { name: "Kentucky", cat: "FOOD", discount: 15, img: "https://images.unsplash.com/photo-1571091655789-84b2c56ea2a3?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=San+Mart√≠n+402,+Campana" },
            { name: "Anik Campana", cat: "FOOD", discount: 50, img: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=9+de+Julio+749,+Campana" },
            { name: "McDonald's Campana", cat: "FOOD", discount: 25, img: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=RN9+Km.+72.5,+Campana" },
            // TALLER MEC√ÅNICO
            { name: "Taller Mec√°nico Campana", cat: "TALLERMECANICO", discount: 40, img: "https://images.unsplash.com/photo-1581093450021-4a7360e9a6b5?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=taller+mecanico+campana" },
            { name: "Auto Service Rodr√≠guez", cat: "TALLERMECANICO", discount: 30, img: "https://images.unsplash.com/photo-1544636331-8985c7dbe9e5?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=auto+service+rodriguez+campana" },
            { name: "Mec√°nica R√°pida", cat: "TALLERMECANICO", discount: 50, img: "https://images.unsplash.com/photo-1581092160607-36e2b8f0b4d4?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=mecanica+rapida+campana" },
            { name: "Taller El Pro", cat: "TALLERMECANICO", discount: 20, img: "https://images.unsplash.com/photo-1605559424843-9e4c228bf1c7?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=taller+el+pro+campana" },
            { name: "Neum√°ticos Campana", cat: "TALLERMECANICO", discount: 35, img: "https://images.unsplash.com/photo-1590674899488-8b8f4e7f3d3f?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=neumaticos+campana" },
            // MEDICINA
            { name: "Farmacia P√©rez", cat: "MEDICINA", discount: 25, img: "https://images.unsplash.com/photo-1580281964126-1d9c2e2f2b9b?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=farmacia+perez+campana" },
            { name: "Cl√≠nica Campana", cat: "MEDICINA", discount: 35, img: "https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=clinica+campana" },
            { name: "Farmacia del Centro", cat: "MEDICINA", discount: 15, img: "https://images.unsplash.com/photo-1576091160550-2173dba999ef?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=farmacia+centro+campana" },
            { name: "Centro M√©dico Norte", cat: "MEDICINA", discount: 45, img: "https://images.unsplash.com/photo-1519494026892-80e512f5f3d8?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=centro+medico+norte+campana" },
            { name: "Farmacia de Turno", cat: "MEDICINA", discount: 20, img: "https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=farmacia+turno+campana" },
            // BELLEZA (NUEVO)
            { name: "Pelquer√≠a Estilo", cat: "BELLEZA", discount: 40, img: "https://images.unsplash.com/photo-1580616295015-9f4a404bde9e?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=peluqueria+campana" },
            { name: "Est√©tica Glam", cat: "BELLEZA", discount: 50, img: "https://images.unsplash.com/photo-1522338242992-e1a5497595f9?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=estetica+campana" },
            { name: "Manicuria & Belleza", cat: "BELLEZA", discount: 25, img: "https://images.unsplash.com/photo-1597220954831-7d90be692ac1?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=manicuria+campana" },
            { name: "Sal√≥n de Belleza Luna", cat: "BELLEZA", discount: 35, img: "https://images.unsplash.com/photo-1512290505090-f90d9134154b?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=salon+belleza+campana" },
            // PETSHOP (NUEVO)
            { name: "Pet Shop Amigos", cat: "PETSHOP", discount: 30, img: "https://images.unsplash.com/photo-1583511655857-d19b40a7a54e?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=pet+shop+campana" },
            { name: "Veterinaria Campana", cat: "PETSHOP", discount: 45, img: "https://images.unsplash.com/photo-1560806887-1f3e4dc4d8d7?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=veterinaria+campana" },
            { name: "Mascotas Feliz", cat: "PETSHOP", discount: 20, img: "https://images.unsplash.com/photo-1552673597-e3e0b5b7f9d0?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=mascotas+campana" },
            { name: "Pet Center", cat: "PETSHOP", discount: 35, img: "https://images.unsplash.com/photo-1601758228041-f3b2795255f1?w=400", wa: "https://wa.me/543489000000", map: "https://www.google.com/maps/search/?api=1&query=pet+shop+campana" },
        ];
        const audio = new (window.AudioContext || window.webkitAudioContext)();
        function playSfx(freq, type='sine', dur=0.1) {
            const o = audio.createOscillator(); const g = audio.createGain();
            o.type = type; o.frequency.value = freq;
            g.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + dur);
            o.connect(g); g.connect(audio.destination);
            o.start(); o.stop(audio.currentTime + dur);
        }
        let dataIndex = 0;
        function initBoard() {
            tiles = [];
            dataIndex = 0;
            let map = Array(ROWS).fill().map(() => Array(COLS).fill(false));
          
            for(let y=0; y<ROWS; y++) {
                for(let x=0; x<COLS; x++) {
                    if(map[y][x] || Math.random() > 0.85) continue;
                  
                    let w = (x < COLS-1 && Math.random() > 0.9) ? 2 : 1;
                    let h = (y < ROWS-1 && Math.random() > 0.9) ? 2 : 1;
                  
                    const item = tilesData[dataIndex % tilesData.length];
                    dataIndex++;
                    const discountCat = item.discount <= 15 ? 'green' : item.discount <= 35 ? 'yellow' : 'red';
                    const tier = discountCat === 'red' ? 'tier-high' : discountCat === 'yellow' ? 'tier-mid' : 'tier-low';
                    tiles.push({
                        id: `t-${x}-${y}`, x, y, w, h,
                        name: item.name, cat: item.cat, img: item.img,
                        promo: `${item.discount}% OFF`,
                        discountCat, tier,
                        wa: item.wa, map: item.map
                    });
                    for(let i=0; i<w; i++) for(let j=0; j<h; j++) map[y+j][x+i] = true;
                }
            }
            render();
            fillTickers();
            // ARMADO ULTRARR√ÅPIDO
            let burstMoves = 0;
            const burst = setInterval(() => {
                for(let i = 0; i < 30; i++) {
                    if(tiles.length === 0) break;
                    const idx = Math.floor(Math.random() * tiles.length);
                    const t = tiles[idx];
                    const el = document.getElementById(t.id);
                    if (el && !el.classList.contains('filtered-out')) {
                        tryMove(t, el);
                    }
                }
                burstMoves++;
                if(burstMoves >= 25) {
                    clearInterval(burst);
                }
            }, 100);
        }
        function render() {
            const board = document.getElementById('puzzle-board');
            const screenW = window.innerWidth - 20;
            CELL_SIZE = (screenW - (GAP * (COLS - 1))) / COLS;
            board.style.width = screenW + 'px';
            board.style.height = (CELL_SIZE * ROWS + GAP * (ROWS - 1)) + 'px';
            board.innerHTML = '';
            tiles.forEach(t => {
                const el = document.createElement('div');
                el.className = `tile ${t.tier}`;
                el.id = t.id;
                el.style.width = `${t.w * CELL_SIZE + (t.w-1)*GAP}px`;
                el.style.height = `${t.h * CELL_SIZE + (t.h-1)*GAP}px`;
                el.style.transform = `translate(${t.x * (CELL_SIZE+GAP)}px, ${t.y * (CELL_SIZE+GAP)}px)`;
              
                el.innerHTML = `
                    <img src="${t.img}" class="tile-img">
                    <div class="tile-info">
                        <span class="tile-title">${t.name}</span>
                        <span class="tile-price">${t.promo}</span>
                    </div>
                `;
                el.onclick = (e) => {
                    playSfx(600, 'triangle');
                    createRipple(e, el);
                    openModal(t);
                    tryMove(t, el);
                    emojiRain();
                };
                board.appendChild(el);
            });
            VanillaTilt.init(document.querySelectorAll(".tile"), {
                max: 20,
                speed: 400,
                glare: true,
                "max-glare": 0.4,
            });
        }
        function tryMove(t, el) {
            const dirs = [{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0}];
            dirs.sort(() => Math.random() - 0.5);
            const occupied = (nx, ny, tw, th) => {
                return tiles.some(ot => {
                    if(ot.id === t.id) return false;
                    return nx < ot.x + ot.w && nx + tw > ot.x && ny < ot.y + ot.h && ny + th > ot.y;
                });
            };
            for(let d of dirs) {
                let nx = t.x + d.x, ny = t.y + d.y;
                if(nx >= 0 && nx+t.w <= COLS && ny >= 0 && ny+t.h <= ROWS && !occupied(nx, ny, t.w, t.h)) {
                    t.x = nx; t.y = ny;
                    el.style.transition = 'transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                    el.style.transform = `translate(${nx * (CELL_SIZE+GAP)}px, ${ny * (CELL_SIZE+GAP)}px)`;
                    return true;
                }
            }
            return false;
        }
        setInterval(() => {
            const moves = Math.floor(Math.random() * 6) + 3;
            for(let i = 0; i < moves; i++) {
                if(tiles.length === 0) break;
                const idx = Math.floor(Math.random() * tiles.length);
                const t = tiles[idx];
                const el = document.getElementById(t.id);
                if (el && !el.classList.contains('filtered-out')) {
                    tryMove(t, el);
                }
            }
        }, 1800);
        function emojiRain() {
            const emojis = ['üéâ','üî•','üí∞','‚≠ê','ü§ë','üéä','‚ú®','üí∏'];
            for(let i = 0; i < 60; i++) {
                const el = document.createElement('div');
                el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                el.style.position = 'fixed';
                el.style.left = Math.random() * 100 + 'vw';
                el.style.top = '-50px';
                el.style.fontSize = (Math.random() * 20 + 25) + 'px';
                el.style.zIndex = '3000';
                el.style.pointerEvents = 'none';
                el.style.animation = `fall ${(Math.random() * 2 + 3)}s linear forwards`;
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 6000);
            }
        }
        function filter(type, val, btn) {
            playSfx(400);
            if(activeFilters[type] === val) {
                activeFilters[type] = null;
                btn.classList.remove('active');
            } else {
                btn.parentElement.querySelectorAll('.btn-filter').forEach(b => {
                    if (!b.classList.contains('all-btn')) b.classList.remove('active');
                });
                activeFilters[type] = val;
                btn.classList.add('active');
            }
            updateVisibility();
        }
        function resetFilter(type, btn) {
            playSfx(400);
            activeFilters[type] = null;
            btn.parentElement.querySelectorAll('.btn-filter').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            updateVisibility();
        }
        function updateVisibility() {
            tiles.forEach(t => {
                const el = document.getElementById(t.id);
                const matchCat = !activeFilters.cat || t.cat === activeFilters.cat;
                const matchDiscount = !activeFilters.discount || t.discountCat === activeFilters.discount;
                el.classList.toggle('filtered-out', !(matchCat && matchDiscount));
            });
        }
        function resetAll() {
            playSfx(500);
            activeFilters = {cat:null, discount:null};
            document.querySelectorAll('.btn-filter').forEach(b => b.classList.remove('active'));
            initBoard();
        }
        function openModal(t) {
            document.getElementById('m-name').innerText = t.name;
            document.getElementById('m-img').src = t.img;
            document.getElementById('m-desc').innerText = `¬°Aprovech√° ${t.promo} en ${t.name}!`;
           
            const waBtn = document.getElementById('m-wa');
            const mapBtn = document.getElementById('m-map');
            waBtn.onclick = () => window.open(t.wa, '_blank');
            mapBtn.onclick = () => window.open(t.map, '_blank');
           
            document.getElementById('modal-shop').classList.add('active');
        }
        function closeModal() { document.getElementById('modal-shop').classList.remove('active'); }
        function openPrivacyModal() { document.getElementById('modal-privacy').classList.add('active'); }
        function closePrivacyModal() { document.getElementById('modal-privacy').classList.remove('active'); }
        function fillTickers() {
            const avisoText = "üìÑ EXTRAV√çO DE DOCUMENTACI√ìN ‚Ä¢ üêï EXTRAV√çO DE MASCOTAS ‚Ä¢ ¬°PUBLICA O BUSCA EN NUESTRAS REDES SOCIALES! ‚Ä¢ ";
            document.getElementById('tick-aviso').innerHTML = `<div class="ticker-item">${avisoText}</div><div class="ticker-item">${avisoText}</div>`;

            const hotText = tiles.filter(t => t.discountCat === 'red').map(t => `üî• ${t.name}: ${t.promo}`).join(' ‚Ä¢ ');
            const infoText = "üé¨ CINE CAMPANA: 2x1 HOY ‚Ä¢ üè• FARMACIA DE TURNO: PEREZ ‚Ä¢ üçª BOLICHE 'CITY': OPEN 24HS ‚Ä¢ ";
            document.getElementById('tick-hot').innerHTML = `<div class="ticker-item">${hotText || 'Sin promos hot'} ‚Ä¢ ${hotText || ''}</div>`;
            document.getElementById('tick-info').innerHTML = `<div class="ticker-item">${infoText} ${infoText}</div>`;
        }
        function createRipple(e, el) {
            const ripple = document.createElement('span');
            ripple.className = 'ripple';
            const rect = el.getBoundingClientRect();
            ripple.style.left = (e.clientX - rect.left) + 'px';
            ripple.style.top = (e.clientY - rect.top) + 'px';
            el.appendChild(ripple);
            setTimeout(() => ripple.remove(), 600);
        }
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
        }, 1000);
        window.onresize = render;
        initBoard();
    </script>
</body>
</html>


